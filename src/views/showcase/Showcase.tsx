import { useEffect } from "react"
import InfoBar from "../../components/InfoBar"
import { NonSelectableCanvas } from "../../components/StudioCanvas"
import { useStudio } from "../../contexts/StudioContext"
import { useObjectUnderMouse } from "../../studio/util/ObjectClickedHook"
import ShowcaseSidebar from "./components/ShowcaseSidebar"
import { useShowcaseGumball } from "./logic/ShowcaseGumball"

const Showcase = () => {
  const { scene, lightGroup, itemsGroup, getSelectedProject, onFrameListeners } = useStudio()
  const project = getSelectedProject()

  useObjectUnderMouse()
  useShowcaseGumball()

  useEffect(() => {
    scene.remove(lightGroup)
    scene.remove(itemsGroup)
    scene.add(project.showcaseProperties.group)

    const onFrame = () => {
      project.model.resetVisuals()
    }
    onFrameListeners.add(onFrame)
    return () => {
      scene.add(lightGroup)
      scene.add(itemsGroup)
      scene.remove(project.showcaseProperties.group)

      onFrameListeners.delete(onFrame)
    }
  })
  return (
    <div className="h-full grid grid-areas-showcase"
      key={project.identifier}
      style={{
        //These would be generated by moving the panels around.
        //For now, we just hardcode them
        gridTemplateColumns: 'auto 300px',
        gridTemplateRows: 'auto 28px'
      }}
    >
      <div className="grid-in-canvas border dark:border-black border-white min-h-0"><NonSelectableCanvas /></div>
      <div className="grid-in-info border dark:border-black border-white"><InfoBar /></div>
      <div className="grid-in-sidebar border dark:border-black border-white"><ShowcaseSidebar /></div>
    </div>
  )
}



export default Showcase;